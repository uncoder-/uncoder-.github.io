<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Centos之上网配置 | 不三之选</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="企业生产用这个系统比较多，打算个人以后用 centos"><meta name=generator content="Hugo 0.76.5"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link href=/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css rel=stylesheet><meta property="og:title" content="Centos之上网配置"><meta property="og:description" content="企业生产用这个系统比较多，打算个人以后用 centos"><meta property="og:type" content="article"><meta property="og:url" content="/posts/centos%E4%B9%8B%E4%B8%8A%E7%BD%91%E9%85%8D%E7%BD%AE/"><meta property="article:published_time" content="2018-01-08T17:07:52+08:00"><meta property="article:modified_time" content="2018-01-08T17:07:52+08:00"><meta itemprop=name content="Centos之上网配置"><meta itemprop=description content="企业生产用这个系统比较多，打算个人以后用 centos"><meta itemprop=datePublished content="2018-01-08T17:07:52+08:00"><meta itemprop=dateModified content="2018-01-08T17:07:52+08:00"><meta itemprop=wordCount content="205"><meta itemprop=keywords content="centos,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Centos之上网配置"><meta name=twitter:description content="企业生产用这个系统比较多，打算个人以后用 centos"></head><body class="ma0 avenir bg-near-white"><header><div class=bg-dark-gray><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">不三之选</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Posts page">Posts</a></li></ul></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=/posts/centos%E4%B9%8B%E4%B8%8A%E7%BD%91%E9%85%8D%E7%BD%AE/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=/posts/centos%E4%B9%8B%E4%B8%8A%E7%BD%91%E9%85%8D%E7%BD%AE/&text=Centos%e4%b9%8b%e4%b8%8a%e7%bd%91%e9%85%8d%e7%bd%ae" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=/posts/centos%E4%B9%8B%E4%B8%8A%E7%BD%91%E9%85%8D%E7%BD%AE/&title=Centos%e4%b9%8b%e4%b8%8a%e7%bd%91%e9%85%8d%e7%bd%ae" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Centos之上网配置</h1><p class=tracked>By <strong>uncoder</strong></p><time class="f6 mv4 dib tracked" datetime=2018-01-08T17:07:52+08:00>January 8, 2018</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>企业生产用这个系统比较多，打算个人以后用 centos</p><h1 id=安装依赖如果自己build>安装依赖(如果自己build)</h1><pre><code>yum install epel-release -y
yum install gcc gettext autoconf libtool automake make pcre-devel asciidoc xmlto c-ares-devel libev-devel libsodium-devel mbedtls-devel -y
</code></pre><p><a href=https://github.com/shadowsocks/shadowsocks-libev>address</a></p><h1 id=设置-yum-源>设置 yum 源</h1><p>地址（ <a href=https://copr.fedorainfracloud.org/coprs/librehat/shadowsocks/>https://copr.fedorainfracloud.org/coprs/librehat/shadowsocks/</a> ）</p><h1 id=创建文件>创建文件</h1><pre><code>touch /etc/yum.repos.d/shadowsocks-libev.repo
</code></pre><h1 id=加入>加入</h1><pre><code>[librehat-shadowsocks]
name=Copr repo for shadowsocks owned by librehat
baseurl=https://copr-be.cloud.fedoraproject.org/results/librehat/shadowsocks/epel-7-$basearch/
type=rpm-md
skip_if_unavailable=True
gpgcheck=1
gpgkey=https://copr-be.cloud.fedoraproject.org/results/librehat/shadowsocks/pubkey.gpg
repo_gpgcheck=0
enabled=1
enabled_metadata=1
</code></pre><h1 id=安装-shadowsocks-libev>安装 shadowsocks-libev</h1><pre><code>yum update
yum install shadowsocks-libev
</code></pre><h1 id=修改-ss-配置>修改 ss 配置</h1><pre><code>/etc/shadowsocks-libev/config.json
{
    &quot;server&quot;:&quot;0.0.0.0&quot;,
    &quot;server_port&quot;:33333,
    &quot;local_port&quot;:1080,
    &quot;password&quot;:&quot;your password&quot;,
    &quot;timeout&quot;:60,
    &quot;method&quot;:&quot;chacha20-ietf-poly1305&quot;
}
</code></pre><h1 id=设置服务>设置服务</h1><pre><code>在/usr/lib/systemd/system/shadowsocks-libev.service，添加以下shell命令
ExecStart=/usr/bin/ss-server -c /etc/shadowsocks-libev/config.json
ExecReload=/bin/kill -HUP $MAINPID
ExecStop=/bin/kill -s QUIT $MAINPID
PrivateTmp=true
KillMode=process
</code></pre><h1 id=启动服务>启动服务</h1><pre><code>systemctl status shadowsocks-libev.service
systemctl start shadowsocks-libev.service
systemctl stop shadowsocks-libev.service
systemctl enable shadowsocks-libev.service //开机自启动
systemctl disable shadowsocks-libev.service
</code></pre><h1 id=开放防火墙端口>开放防火墙端口</h1><pre><code>firewall-cmd --zone=public --add-port=8388/tcp --permanent
firewall-cmd --zone=public --add-port=8388/udp --permanent
firewall-cmd --reload
</code></pre><h1 id=开启-bbr>开启 bbr</h1><ol start=0><li>查看当前内核<code>uname -r</code></li><li>下载更换内核(4.9 以上才能使用)
最新<a href=http://elrepo.org/linux/kernel/el7/x86_64/RPMS/>内核</a></li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
yum --enablerepo<span style=color:#f92672>=</span>elrepo-kernel install kernel-ml -y
</code></pre></div><ol start=2><li>查看当前内核<code>rpm -qa | grep kernel</code></li><li>查看内核列表<code>awk -F\' '$1=="menuentry " {print i++ " : " $2}' /etc/grub2.cfg</code></li><li>设置最新内核启动<code>grub2-set-default 0</code></li><li>重启<code>reboot</code></li><li>检查<code>uname -r</code>是否大于 4.9</li><li>查看系统<code>cat /proc/version</code>/<code>cat /etc/os-release</code></li><li>更新配置<code>/etc/sysctl.conf</code></li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>net.core.default_qdisc <span style=color:#f92672>=</span> fq
net.ipv4.tcp_congestion_control <span style=color:#f92672>=</span> bbr
</code></pre></div><ol start=7><li>生效<code>sysctl -p</code></li><li>检查<code>lsmod | grep bbr</code>，若已经运行，则安装成功来源</li></ol><p>备注：</p><p>执行程序时，若报错</p><pre><code>ss-server: error while loading shared libraries: libmbedcrypto.so.0: cannot open shared object file: No such file or directory

解决方案：
cd /usr/lib64
// 查找
ll | grep libmbedcrypto
// 比如，这里是把so指向so.0
ln -s libmbedcrypto.so libmbedcrypto.so.0
</code></pre><p><a href=https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AFTCP-BBR%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95>参考1</a></p><p><a href=https://www.isthnew.com/archives/centos7-bbr.html>参考2</a></p><p>搞定收工</p><ul class=pa0><li class=list><a href=/tags/centos class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">centos</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-dark-gray bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=/>&copy; 不三之选 2020</a><div></div></div></footer><script src=/dist/js/app.3fc0f988d21662902933.js></script></body></html>